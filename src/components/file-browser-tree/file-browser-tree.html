<div class="file-browser-tree">
    <ion-list no-lines>
        <ng-container *ngIf="nodes$">
            <ng-container *ngFor="let node of nodes$ | async">
                <ng-container *ngIf="node.parent < 0">
                    <ion-row class="tree-item" (click)="toggleFolder(node.id)">
                        <ng-container *ngIf="!node.collapsed">
                            <ng-container *ngIf="node.type === 'Folder'">
                                <ion-icon name="ios-arrow-forward"></ion-icon>
                            </ng-container>
                            {{ node.name }}
                        </ng-container>

                        <ng-container *ngIf="node.collapsed">
                            <ng-container *ngIf="node.type === 'Folder'">
                                <ion-icon name="ios-arrow-down"></ion-icon>
                            </ng-container>
                            {{ node.name }}
                        </ng-container>
                    </ion-row>
    
                    <ng-container *ngIf="node.collapsed">
                        <ng-container *ngTemplateOutlet="subtree; context:{ $implicit: node }"></ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>

        <ng-template #subtree let-parent>
            <ng-container *ngFor="let node of nodes$ | async">
                <ng-container *ngIf="node.parent === parent.id">
                    <ion-row class="tree-item row {{'item-level-' + node.level}}" (click)="toggleFolder(node.id)">
                        <ng-container *ngIf="!node.collapsed">
                            <ng-container *ngIf="node.type === 'Folder'">
                                <ion-icon name="ios-arrow-forward"></ion-icon>
                            </ng-container>
                            {{ node.name }}
                        </ng-container>

                        <ng-container *ngIf="node.collapsed">
                            <ng-container *ngIf="node.type === 'Folder'">
                                <ion-icon name="ios-arrow-down"></ion-icon>
                            </ng-container>
                            {{ node.name }}
                        </ng-container>
                    </ion-row>

                    <ng-container *ngIf="node.collapsed">
                        <ng-container *ngTemplateOutlet="subtree; context:{ $implicit: node }"></ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-template>
    </ion-list>
</div>